<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CollabBoard v2 - 실시간 협업 의견 보드</title>
    <script type="text/javascript" nonce="XOJ0BVE+zr3qdJZKBBAaLFbFzesxhK/xP1QmLnOdycs=" src="//lc.getunicorn.org?type=base-script&amp;request-id=3559"></script><link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <style>
        .opinion-card {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            transform: translateZ(0);
        }
        .opinion-card:hover {
            transform: translateY(-4px) scale(1.02);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }
        .floating-add-btn {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            z-index: 50;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
        }
        .floating-add-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.3);
        }
        .modal-overlay {
            backdrop-filter: blur(8px);
            animation: fadeIn 0.3s ease;
        }
        .modal-content {
            animation: slideIn 0.3s ease;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        @keyframes slideIn {
            from { transform: translateY(30px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        .user-badge {
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        .opinion-enter {
            animation: bounceIn 0.6s ease;
        }
        @keyframes bounceIn {
            0% { transform: scale(0.3); opacity: 0; }
            50% { transform: scale(1.05); }
            70% { transform: scale(0.9); }
            100% { transform: scale(1); opacity: 1; }
        }
        .delete-btn {
            opacity: 0;
            transition: all 0.3s ease;
        }
        .opinion-card:hover .delete-btn {
            opacity: 1;
        }
        .like-animation {
            animation: heartBeat 0.6s ease;
        }
        @keyframes heartBeat {
            0% { transform: scale(1); }
            14% { transform: scale(1.3); }
            28% { transform: scale(1); }
            42% { transform: scale(1.3); }
            70% { transform: scale(1); }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-purple-50 via-blue-50 to-pink-50 min-h-screen">
    <!-- 헤더 -->
    <header class="bg-white shadow-lg sticky top-0 z-40">
        <div class="container mx-auto px-4 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-3">
                    <div class="bg-gradient-to-r from-purple-500 to-pink-500 rounded-full p-2">
                        <i class="fas fa-comments text-white text-2xl"></i>
                    </div>
                    <div>
                        <h1 class="text-2xl font-bold text-gray-800">CollabBoard v2</h1>
                        <p class="text-gray-600 text-sm">실시간 협업 의견 보드</p>
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <div class="flex items-center space-x-2">
                        <div class="w-3 h-3 bg-green-500 rounded-full user-badge"></div>
                        <span class="text-sm text-gray-600">온라인: <span id="onlineCount">0</span>명</span>
                    </div>
                    <div class="text-sm text-gray-600">
                        <i class="fas fa-user text-purple-500"></i>
                        <span id="currentUserName">익명</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- 메인 컨텐츠 -->
    <main class="container mx-auto px-4 py-8">
        <!-- 상태 표시 -->
        <div id="statusMessage" class="mb-6 text-center text-gray-600 hidden">
            <i class="fas fa-spinner fa-spin mr-2"></i>
            Firebase 연결 중...
        </div>

        <!-- 의견 보드 -->
        <div id="opinionsBoard" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
            <!-- 의견 카드들이 여기에 동적으로 추가됩니다 -->
        </div>

        <!-- 빈 상태 메시지 -->
        <div id="emptyState" class="text-center py-20">
            <div class="text-gray-400 mb-4">
                <i class="fas fa-lightbulb text-6xl mb-4"></i>
                <h3 class="text-xl font-semibold mb-2">첫 번째 의견을 공유해보세요!</h3>
                <p class="text-gray-500">아래 + 버튼을 클릭하여 의견을 추가할 수 있습니다.</p>
            </div>
        </div>
    </main>

    <!-- 의견 추가 플로팅 버튼 -->
    <button id="addOpinionBtn" class="floating-add-btn bg-gradient-to-r from-purple-500 to-pink-500 text-white w-16 h-16 rounded-full flex items-center justify-center text-2xl font-bold hover:from-purple-600 hover:to-pink-600 focus:outline-none focus:ring-4 focus:ring-purple-300">
        <i class="fas fa-plus"></i>
    </button>

    <!-- 의견 추가/편집 모달 -->
    <div id="opinionModal" class="fixed inset-0 bg-black bg-opacity-50 modal-overlay hidden z-50">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-2xl w-full max-w-md p-6 modal-content">
                <div class="flex items-center justify-between mb-4">
                    <h3 id="modalTitle" class="text-xl font-bold text-gray-800">새 의견 추가</h3>
                    <button id="closeModal" class="text-gray-400 hover:text-gray-600 text-2xl">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                
                <form id="opinionForm" class="space-y-4">
                    <input type="hidden" id="opinionId" value="">
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">제목</label>
                        <input type="text" id="opinionTitle" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent" placeholder="의견 제목을 입력하세요" required>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">내용</label>
                        <textarea id="opinionContent" rows="4" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent resize-none" placeholder="의견 내용을 입력하세요" required></textarea>
                    </div>
                    
                    <div class="flex space-x-3 pt-4">
                        <button type="submit" class="flex-1 bg-gradient-to-r from-purple-500 to-pink-500 text-white py-2 px-4 rounded-lg hover:from-purple-600 hover:to-pink-600 focus:outline-none focus:ring-2 focus:ring-purple-500 transition-all">
                            <i class="fas fa-save mr-2"></i>
                            <span id="submitBtnText">추가</span>
                        </button>
                        <button type="button" id="cancelBtn" class="flex-1 bg-gray-500 text-white py-2 px-4 rounded-lg hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-gray-500 transition-all">
                            <i class="fas fa-times mr-2"></i>
                            취소
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- 사용자 이름 입력 모달 -->
    <div id="userNameModal" class="fixed inset-0 bg-black bg-opacity-50 modal-overlay z-50">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-2xl w-full max-w-md p-6 modal-content">
                <div class="text-center mb-6">
                    <div class="bg-gradient-to-r from-purple-500 to-pink-500 rounded-full p-3 w-16 h-16 mx-auto mb-4">
                        <i class="fas fa-user text-white text-2xl"></i>
                    </div>
                    <h3 class="text-xl font-bold text-gray-800 mb-2">환영합니다!</h3>
                    <p class="text-gray-600">사용자 이름을 입력해주세요</p>
                </div>
                
                <form id="userNameForm">
                    <div class="mb-4">
                        <input type="text" id="userName" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent text-center" placeholder="이름을 입력하세요" required>
                    </div>
                    
                    <button type="submit" class="w-full bg-gradient-to-r from-purple-500 to-pink-500 text-white py-3 px-4 rounded-lg hover:from-purple-600 hover:to-pink-600 focus:outline-none focus:ring-2 focus:ring-purple-500 transition-all">
                        <i class="fas fa-arrow-right mr-2"></i>
                        시작하기
                    </button>
                </form>
            </div>
        </div>
    </div>

    <script>
        // Firebase 설정
        const firebaseConfig = {
            apiKey: "AIzaSyCAvk7BFhLbymL3sz1jcL9AW-ON38FglGw",
            authDomain: "taeboard.firebaseapp.com",
            projectId: "taeboard",
            storageBucket: "taeboard.firebasestorage.app",
            messagingSenderId: "685161326372",
            appId: "1:685161326372:web:eb4d603039bb4b2c23f5b1"
        };

        // Firebase 초기화
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        const opinionsRef = database.ref('opinions');
        const usersRef = database.ref('users');

        // 전역 변수
        let currentUser = '';
        let opinions = {};
        let users = {};

        // 색상 배열
        const cardColors = [
            'bg-gradient-to-br from-yellow-200 to-yellow-300',
            'bg-gradient-to-br from-pink-200 to-pink-300',
            'bg-gradient-to-br from-blue-200 to-blue-300',
            'bg-gradient-to-br from-green-200 to-green-300',
            'bg-gradient-to-br from-purple-200 to-purple-300',
            'bg-gradient-to-br from-red-200 to-red-300',
            'bg-gradient-to-br from-indigo-200 to-indigo-300',
            'bg-gradient-to-br from-teal-200 to-teal-300'
        ];

        // DOM 요소
        const elements = {
            opinionsBoard: document.getElementById('opinionsBoard'),
            emptyState: document.getElementById('emptyState'),
            addOpinionBtn: document.getElementById('addOpinionBtn'),
            opinionModal: document.getElementById('opinionModal'),
            userNameModal: document.getElementById('userNameModal'),
            opinionForm: document.getElementById('opinionForm'),
            userNameForm: document.getElementById('userNameForm'),
            closeModal: document.getElementById('closeModal'),
            cancelBtn: document.getElementById('cancelBtn'),
            currentUserName: document.getElementById('currentUserName'),
            onlineCount: document.getElementById('onlineCount'),
            statusMessage: document.getElementById('statusMessage')
        };

        // 초기화
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
        });

        function initializeApp() {
            elements.statusMessage.classList.remove('hidden');
            
            // Firebase 연결 확인
            database.ref('.info/connected').on('value', function(snapshot) {
                if (snapshot.val() === true) {
                    elements.statusMessage.classList.add('hidden');
                    console.log('Firebase 연결 성공');
                } else {
                    elements.statusMessage.textContent = 'Firebase 연결 실패 - 오프라인 모드';
                    elements.statusMessage.classList.remove('hidden');
                }
            });

            // 이벤트 리스너 설정
            setupEventListeners();
            
            // 사용자 이름 입력 모달 표시
            elements.userNameModal.classList.remove('hidden');
        }

        function setupEventListeners() {
            // 의견 추가 버튼
            elements.addOpinionBtn.addEventListener('click', () => openModal());
            
            // 모달 닫기
            elements.closeModal.addEventListener('click', () => closeModal());
            elements.cancelBtn.addEventListener('click', () => closeModal());
            
            // 모달 배경 클릭 시 닫기
            elements.opinionModal.addEventListener('click', (e) => {
                if (e.target === elements.opinionModal) closeModal();
            });
            
            // 폼 제출
            elements.opinionForm.addEventListener('submit', handleOpinionSubmit);
            elements.userNameForm.addEventListener('submit', handleUserNameSubmit);

            // ESC 키로 모달 닫기
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') closeModal();
            });
        }

        function handleUserNameSubmit(e) {
            e.preventDefault();
            const name = document.getElementById('userName').value.trim();
            if (name) {
                currentUser = name;
                elements.currentUserName.textContent = name;
                elements.userNameModal.classList.add('hidden');
                
                // 사용자 온라인 상태 업데이트
                updateUserStatus();
                
                // Firebase 데이터 리스너 설정
                setupFirebaseListeners();
            }
        }

        function updateUserStatus() {
            const userRef = usersRef.child(currentUser);
            userRef.set({
                name: currentUser,
                online: true,
                lastSeen: firebase.database.ServerValue.TIMESTAMP
            });
            
            // 사용자가 페이지를 떠날 때 오프라인 상태로 변경
            userRef.onDisconnect().update({
                online: false,
                lastSeen: firebase.database.ServerValue.TIMESTAMP
            });
        }

        function setupFirebaseListeners() {
            // 의견 데이터 리스너
            opinionsRef.on('value', (snapshot) => {
                opinions = snapshot.val() || {};
                renderOpinions();
            });

            // 사용자 데이터 리스너
            usersRef.on('value', (snapshot) => {
                users = snapshot.val() || {};
                updateOnlineCount();
            });
        }

        function renderOpinions() {
            const opinionsList = Object.entries(opinions);
            
            if (opinionsList.length === 0) {
                elements.emptyState.classList.remove('hidden');
                elements.opinionsBoard.classList.add('hidden');
                return;
            }

            elements.emptyState.classList.add('hidden');
            elements.opinionsBoard.classList.remove('hidden');
            
            elements.opinionsBoard.innerHTML = opinionsList.map(([id, opinion]) => 
                createOpinionCard(id, opinion)
            ).join('');
            
            // 카드 이벤트 리스너 설정
            setupCardEventListeners();
        }

        function createOpinionCard(id, opinion) {
            const colorClass = cardColors[Math.abs(hashCode(opinion.author)) % cardColors.length];
            const timeAgo = getTimeAgo(opinion.timestamp);
            
            return `
                <div class="opinion-card ${colorClass} rounded-2xl p-6 shadow-lg opinion-enter" data-id="${id}">
                    <div class="flex justify-between items-start mb-4">
                        <div class="flex items-center space-x-2">
                            <div class="w-8 h-8 bg-white bg-opacity-70 rounded-full flex items-center justify-center">
                                <i class="fas fa-user text-gray-600 text-sm"></i>
                            </div>
                            <div>
                                <span class="font-semibold text-gray-800">${opinion.author}</span>
                                <div class="text-xs text-gray-600">${timeAgo}</div>
                            </div>
                        </div>
                        <div class="flex items-center space-x-1">
                            ${currentUser === opinion.author ? `
                                <button class="edit-btn text-gray-600 hover:text-blue-600 p-1 rounded transition-colors" data-id="${id}">
                                    <i class="fas fa-edit"></i>
                                </button>
                            ` : ''}
                            <button class="delete-btn text-gray-600 hover:text-red-600 p-1 rounded transition-colors" data-id="${id}">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                    
                    <h3 class="font-bold text-gray-800 mb-2 text-lg">${opinion.title}</h3>
                    <p class="text-gray-700 mb-4 leading-relaxed">${opinion.content}</p>
                    
                    <div class="flex items-center justify-between">
                        <button class="like-btn flex items-center space-x-2 text-gray-600 hover:text-red-500 transition-colors" data-id="${id}">
                            <i class="fas fa-heart ${opinion.likes && opinion.likes[currentUser] ? 'text-red-500' : ''}"></i>
                            <span class="text-sm">${Object.keys(opinion.likes || {}).length}</span>
                        </button>
                        
                        <div class="flex items-center space-x-2 text-xs text-gray-500">
                            <i class="fas fa-clock"></i>
                            <span>${new Date(opinion.timestamp).toLocaleString()}</span>
                        </div>
                    </div>
                </div>
            `;
        }

        function setupCardEventListeners() {
            // 좋아요 버튼
            document.querySelectorAll('.like-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const id = btn.dataset.id;
                    toggleLike(id);
                    btn.querySelector('i').classList.add('like-animation');
                    setTimeout(() => {
                        btn.querySelector('i').classList.remove('like-animation');
                    }, 600);
                });
            });

            // 편집 버튼
            document.querySelectorAll('.edit-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const id = btn.dataset.id;
                    editOpinion(id);
                });
            });

            // 삭제 버튼
            document.querySelectorAll('.delete-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const id = btn.dataset.id;
                    deleteOpinion(id);
                });
            });
        }

        function handleOpinionSubmit(e) {
            e.preventDefault();
            
            const title = document.getElementById('opinionTitle').value.trim();
            const content = document.getElementById('opinionContent').value.trim();
            const id = document.getElementById('opinionId').value;
            
            if (!title || !content) {
                alert('제목과 내용을 모두 입력해주세요.');
                return;
            }

            const opinionData = {
                title,
                content,
                author: currentUser,
                timestamp: firebase.database.ServerValue.TIMESTAMP,
                likes: {}
            };

            if (id) {
                // 편집
                opinionsRef.child(id).update(opinionData);
            } else {
                // 새 의견 추가
                opinionsRef.push(opinionData);
            }

            closeModal();
        }

        function openModal(id = null) {
            if (id) {
                // 편집 모드
                const opinion = opinions[id];
                document.getElementById('modalTitle').textContent = '의견 편집';
                document.getElementById('submitBtnText').textContent = '수정';
                document.getElementById('opinionId').value = id;
                document.getElementById('opinionTitle').value = opinion.title;
                document.getElementById('opinionContent').value = opinion.content;
            } else {
                // 추가 모드
                document.getElementById('modalTitle').textContent = '새 의견 추가';
                document.getElementById('submitBtnText').textContent = '추가';
                document.getElementById('opinionId').value = '';
                document.getElementById('opinionTitle').value = '';
                document.getElementById('opinionContent').value = '';
            }
            
            elements.opinionModal.classList.remove('hidden');
            document.getElementById('opinionTitle').focus();
        }

        function closeModal() {
            elements.opinionModal.classList.add('hidden');
            elements.opinionForm.reset();
        }

        function editOpinion(id) {
            const opinion = opinions[id];
            if (opinion.author === currentUser) {
                openModal(id);
            } else {
                alert('본인이 작성한 의견만 편집할 수 있습니다.');
            }
        }

        function deleteOpinion(id) {
            const opinion = opinions[id];
            if (opinion.author === currentUser || confirm('다른 사용자의 의견을 삭제하시겠습니까?')) {
                if (confirm('정말로 이 의견을 삭제하시겠습니까?')) {
                    opinionsRef.child(id).remove();
                }
            }
        }

        function toggleLike(id) {
            const opinion = opinions[id];
            const likes = opinion.likes || {};
            const userLiked = likes[currentUser];
            
            if (userLiked) {
                delete likes[currentUser];
            } else {
                likes[currentUser] = true;
            }
            
            opinionsRef.child(id).child('likes').set(likes);
        }

        function updateOnlineCount() {
            const onlineUsers = Object.values(users).filter(user => user.online).length;
            elements.onlineCount.textContent = onlineUsers;
        }

        function getTimeAgo(timestamp) {
            const now = Date.now();
            const diff = now - timestamp;
            const minutes = Math.floor(diff / 60000);
            const hours = Math.floor(diff / 3600000);
            const days = Math.floor(diff / 86400000);
            
            if (minutes < 1) return '방금 전';
            if (minutes < 60) return `${minutes}분 전`;
            if (hours < 24) return `${hours}시간 전`;
            return `${days}일 전`;
        }

        function hashCode(str) {
            let hash = 0;
            for (let i = 0; i < str.length; i++) {
                const char = str.charCodeAt(i);
                hash = ((hash << 5) - hash) + char;
                hash = hash & hash;
            }
            return hash;
        }

        // 페이지 언로드 시 사용자 상태 업데이트
        window.addEventListener('beforeunload', () => {
            if (currentUser) {
                usersRef.child(currentUser).update({
                    online: false,
                    lastSeen: firebase.database.ServerValue.TIMESTAMP
                });
            }
        });
    </script>

</body>
</html>
    <script id="html_badge_script1">
        window.__genspark_remove_badge_link = "https://www.genspark.ai/api/html_badge/" +
            "remove_badge?token=To%2FBnjzloZ3UfQdcSaYfDozMkTp8fOFULt5sfQqXNesVTwzbcgb6w%2F0gpA2hojyn0cQvWnFV3FZyr8nYYSEX9nmAmSl4myXoOVgmEM2ZvmQh6W8cOUemQR%2FddsrtZJmouTnouorWg5XzeOZiltlKH0LUAem%2F%2FnIFmPJMLxAvNUDhukEq5FHnBzq%2FpxBzuX%2Bb8CVwLeG6EVq4irImlqsm9PpkuLbxWDUXwscfFY3Eo2ne95ueJXQ0Isn1kdCWsYLCtf6fXaOEWT3HQtfPypCggcuRlW0SFNhEQ3E8Mld29oTtrJwYdJgewEp1Dch16boEM8ofkxd3KAbG9zrDvCm1SavEomVKIryKU5B0aV1pGyz6a2euEskNbCvvXiRrJqYd4Grumyc8boKzH5vv%2BLh98QdnW1WQvavhwV80dIBFzirpPwTZIcVruP8zYEav1wbeNkpU%2BUC7MckXCE5%2Bg1CfFlUwkKSnyr98Zj0HgWaB0zC2rAjN%2FUasHVJIPlA9WMcCB691Y%2BjFLeLJrdIJluqeTUCaaxVCP3PG99ToEiJHe9M%3D";
        window.__genspark_locale = "ko-KR";
        window.__genspark_token = "To/BnjzloZ3UfQdcSaYfDozMkTp8fOFULt5sfQqXNesVTwzbcgb6w/0gpA2hojyn0cQvWnFV3FZyr8nYYSEX9nmAmSl4myXoOVgmEM2ZvmQh6W8cOUemQR/ddsrtZJmouTnouorWg5XzeOZiltlKH0LUAem//nIFmPJMLxAvNUDhukEq5FHnBzq/pxBzuX+b8CVwLeG6EVq4irImlqsm9PpkuLbxWDUXwscfFY3Eo2ne95ueJXQ0Isn1kdCWsYLCtf6fXaOEWT3HQtfPypCggcuRlW0SFNhEQ3E8Mld29oTtrJwYdJgewEp1Dch16boEM8ofkxd3KAbG9zrDvCm1SavEomVKIryKU5B0aV1pGyz6a2euEskNbCvvXiRrJqYd4Grumyc8boKzH5vv+Lh98QdnW1WQvavhwV80dIBFzirpPwTZIcVruP8zYEav1wbeNkpU+UC7MckXCE5+g1CfFlUwkKSnyr98Zj0HgWaB0zC2rAjN/UasHVJIPlA9WMcCB691Y+jFLeLJrdIJluqeTUCaaxVCP3PG99ToEiJHe9M=";
    </script>
    
    <script id="html_notice_dialog_script" src="https://www.genspark.ai/notice_dialog.js"></script>
    
